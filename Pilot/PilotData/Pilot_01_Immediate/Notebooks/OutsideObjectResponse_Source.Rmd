---
title: "Source memory performance for objects outside the rooms"
output: 
      html_document:
          fig_caption: yes
          highlight: default
          number_sections: yes
          theme: lumen
          toc: yes
          toc_depth: 5
          toc_float: true
          
      html_notebook:
          fig_caption: yes
          highlight: default
          number_sections: yes
          theme: lumen
          toc: yes
          toc_depth: 5
          toc_float: true
          
      header-includes:
            - \usepackage{xcolor}
            - \usepackage{framed}
            - \usepackage{fontspec}
---

\setmainfont{Noto Sans}
\colorlet{shadecolor}{gray!10}
\color{red}

<style>
body {
  font-size: 15px;
}

p.caption {
  font-weight: 500;
  font-style: italic;
}

code.r {
  font-family: Consolas, Monaco, monospace;
  font-size: 12px;
}
</style>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)
options(knitr.table.format = "html", cache=TRUE) # "latex" for PDF
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
library(data.table); library(ggplot2); library(nlme); library(ez); library(multcomp)
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
load("../GroupData/OutsideObjectResponseFrequencies.RData")
```

# Visual inspection of the data
```{r Find out bad participants, echo=FALSE}
bad.ps.less.strict <- NULL

participants <- as.character(unique(Curiosity.Recall.Freq.Rsp$SubjectNo))

for (this.p in participants) {
  this.data <- Curiosity.Recall.Freq.Rsp[SubjectNo == this.p]
  if (this.data[CorrObjResp == "New" & Response == "Seen"]$Frequency > this.data[CorrObjResp == "Seen" & Response == "Seen"]$Frequency) {
    bad.ps.less.strict <- c(bad.ps.less.strict, this.p)
  }
}

if (length(bad.ps.less.strict) > 0) { print(bad.ps.less.strict) }

Curiosity.Recall.Freq.Grp$Type2 <- "Good"
Curiosity.Recall.Freq.Grp[SubjectNo %in% bad.ps.less.strict]$Type2 <- "Bad"

Curiosity.Recall.Freq.Rsp$Type2 <- "Good"
Curiosity.Recall.Freq.Rsp[SubjectNo %in% bad.ps.less.strict]$Type2 <- "Bad"
```

# Novelty Benefits 

## Check the data
```{r, echo=FALSE}
load("../GroupData/OutsideObjectResponseNoveltyGroups.RData")
outside.hit.rate.novelty.group$Group <- factor(outside.hit.rate.novelty.group$Group)
```

**Is there any corrected hit rate < 0?**
```{r, echo=FALSE}
n.negative.SrcAcc <- nrow(outside.hit.rate.novelty.group[SrcAcc < 0])
```

There are `r n.negative.SrcAcc` negative value out of a total of `r nrow(outside.hit.rate.novelty.group)` values. 
```{r, echo=FALSE}
outside.hit.rate.novelty.group[SrcAcc < 0]
```

```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.novelty.group[SrcAcc < 0]$SrcAcc <- 0
```


## Compare mean accuracy between *novel* and *familiar* rooms

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=3.6, fig.height=3, fig.cap='Figure1. Mean accuracy for item memory respectively for Familiar and Novel rooms.'}
MeanSrcAccNoveltyCmpPlot <- ggplot(outside.hit.rate.novelty.group, aes(x = Group, y = SrcAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  labs(x = "Room novelty", y = "Corrected hit rate")

MeanSrcAccNoveltyCmpPlot
```

```{r, echo = FALSE}
outside.hit.rate.novelty.group[, .(Mean = mean(SrcAcc, na.rm = TRUE), SD = sd(SrcAcc, na.rm = TRUE), N = length(SrcAcc)), by = c("Group")]
t.test(SrcAcc ~ Group, data = outside.hit.rate.novelty.group, paired = TRUE)
```

## Any difference between *Early* and *Later* object groups?
```{r, echo = FALSE}
load("../GroupData/OutsideObjectResponseItemOrders.RData")
```

### Check the data

**Is there any corrected hit rate < 0?**
```{r, echo=FALSE}
n.negative.SrcAcc <- nrow(outside.hit.rate.item.order.novelty[SrcAcc < 0])
```

There are `r n.negative.SrcAcc` negative value out of a total of `r nrow(outside.hit.rate.item.order.novelty)` values. 
```{r, echo=FALSE}
outside.hit.rate.item.order.novelty[SrcAcc < 0]
```

```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.item.order.novelty[SrcAcc < 0]$SrcAcc <- 0
```

### Analysis
```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=4.8, fig.height=3}
MeanSrcAccNoveltyTmpOrdCmpPlot <- ggplot(outside.hit.rate.item.order.novelty, aes(x = Group, y = SrcAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  facet_wrap( ~ ObjOrdGrp) +
  labs(x = "Room novelty", y = "Corrected hit rate")

MeanSrcAccNoveltyTmpOrdCmpPlot
```

```{r, echo = FALSE, warning=FALSE}
outside.hit.rate.item.order.novelty[, .(Mean = mean(SrcAcc, na.rm = TRUE), SD = sd(SrcAcc, na.rm = TRUE), N = length(SrcAcc)), by = c("Group", "ObjOrdGrp")]

ezANOVA(outside.hit.rate.item.order.novelty, dv = .(SrcAcc), wid = .(SubjectNo), within = .(Group, ObjOrdGrp))
```

# Curiosity Enhancement
```{r, echo=FALSE}
load("../GroupData/OutsideObjectsResponsePerRoom.RData")
load("../GroupData/OutsideObjectResponseCuriosityGroups.RData")
```

## Check the data

### Is there any corrected hit rate < 0?
#### For the data per room
```{r, echo=FALSE}
n.negative.SrcAcc <- nrow(outside.hit.rate.per.room[SrcAcc < 0])
```

  * There are `r n.negative.SrcAcc` negative values out of a total of `r nrow(outside.hit.rate.per.room)` values.

```{r, echo=FALSE}
outside.hit.rate.per.room[SrcAcc < 0, ]
```

```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.per.room[SrcAcc < 0]$SrcAcc <- 0
```


#### For the data per curiosity group
```{r, echo=FALSE}
n.negative.SrcAcc <- nrow(outside.hit.rate.curiosity.group[SrcAcc < 0])
```

  * There are `r n.negative.SrcAcc` negative value for curiosity group (1 ~ 3 and 5 ~ 7) out of a total of `r nrow(outside.hit.rate.curiosity.group)` values.

```{r, echo=FALSE}
outside.hit.rate.curiosity.group[SrcAcc < 0]
```
  
```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.curiosity.group[SrcAcc < 0]$SrcAcc <- 0
```

#### For the data per curiosity group (median)
```{r, echo=FALSE}
n.negative.SrcAcc <- nrow(outside.hit.rate.curiosity.group.median[SrcAcc < 0])
```

  * There are `r n.negative.SrcAcc` negative value for curiosity group (median) out of a total of `r nrow(outside.hit.rate.curiosity.group.median)` values.
  
```{r, echo=FALSE}
outside.hit.rate.curiosity.group.median[SrcAcc < 0]
```

```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.curiosity.group.median[SrcAcc < 0]$SrcAcc <- 0
```

## Mean accuracy of item memory as a function of curiosity rating
```{r, echo=FALSE, fig.align='center', fig.width=3.6, fig.height=3}
ggplot(outside.hit.rate.per.room, aes(x = CurRating, y = SrcAcc)) +
  stat_summary(fun.data = mean_cl_boot, na.rm = T, geom = "errorbar", width = 0.2) +
  stat_summary(fun.y = mean, na.rm = T, geom = "point", size = 2) +
  stat_smooth(method = "lm", se = FALSE) +
  scale_x_continuous(breaks = c(1:7)) +
  labs(x = "Curiosity rating", y = "corrected hit rate") 
```

## Testing the relationship between mean accuracy of item memory and curiosity rating
Build models with item memory accuracy as $y$ and examine effects of curiosity rating by including it into the model and then comparing the model fits. 

* `baseline.rating` is the model with only an intercept, showing no change in item memory as a function of curiosity rating. 
* `rating.intercept` is the model with $\small CuriosityRating$ included, showing the effects of curiosity rating. 
* `rating.slope` is the model allowing the slope (i.e., relationship between item memory and curiosity rating) varying across participants. 

```{r, echo = FALSE}
baseline.rating <- lme(SrcAcc ~ 1, random = ~ 1|SubjectNo, data = outside.hit.rate.per.room, method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE), na.action = na.exclude)

rating.intercept <- update(baseline.rating, .~. + CurRating)
rating.slope     <- update(rating.intercept, random = ~ 1 + CurRating|SubjectNo)

anova(baseline.rating, rating.intercept, rating.slope)

summary(rating.slope)
```

## Check the curiosity groups
### Separate the groups according to the rating
- *High*: curiosity rating > 4
- *Low*: curiosity rating < 4
- For curiosity rating = 4, discarded

```{r echo=FALSE}
outside.hit.rate.curiosity.group$CurGrp <- factor(outside.hit.rate.curiosity.group$CurGrp)
outside.hit.rate.curiosity.group$CurGrp <- factor(outside.hit.rate.curiosity.group$CurGrp, levels = levels(outside.hit.rate.curiosity.group$CurGrp)[c(2, 1)])

outside.hit.rate.item.order.curiosity$CurGrp <- factor(outside.hit.rate.item.order.curiosity$CurGrp)
outside.hit.rate.item.order.curiosity$CurGrp <- factor(outside.hit.rate.item.order.curiosity$CurGrp, levels = levels(outside.hit.rate.item.order.curiosity$CurGrp)[c(2, 1)])
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=3.6, fig.height=3}
MeanSrcAccCurGrpCmpPlot <- ggplot(outside.hit.rate.curiosity.group[!is.na(CurGrp)], aes(x = CurGrp, y = SrcAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  labs(x = "Curiosity group", y = "corrected hit rate")

MeanSrcAccCurGrpCmpPlot
```

```{r, echo = FALSE}
outside.hit.rate.curiosity.group[!is.na(CurGrp), .(Mean = mean(SrcAcc, na.rm = TRUE), SD = sd(SrcAcc, na.rm = TRUE), N = length(SrcAcc)), by = c("CurGrp")]
cur.grp.model <- lme(SrcAcc ~ CurGrp,random = ~ 1 + CurGrp|SubjectNo,  data = outside.hit.rate.curiosity.group[!is.na(CurGrp)], method = "ML")
summary(cur.grp.model)
```

#### Curiosity groups and temporal order of the objects
##### Check the data

**Is there any corrected hit rate < 0?**

```{r, echo=FALSE}
n.negative.SrcAcc <- nrow(outside.hit.rate.item.order.curiosity[SrcAcc < 0 & !is.na(CurGrp)])
```

* There are `r n.negative.SrcAcc` negative values out of a total of `r nrow(outside.hit.rate.item.order.curiosity)` participants.

```{r, echo=FALSE}
outside.hit.rate.item.order.curiosity[SrcAcc < 0 & !is.na(CurGrp), ]
```

```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.item.order.curiosity[SrcAcc < 0 & !is.na(CurGrp)]$SrcAcc <- 0
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=6.4, fig.height=3}
outside.hit.rate.item.order.curiosity[SrcAcc < 0]$SrcAcc = 0

MeanSrcAccCurGrpOrdPlot <- ggplot(outside.hit.rate.item.order.curiosity[!is.na(CurGrp)], aes(x = CurGrp, y = SrcAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  facet_wrap( ~ ObjOrdGrp) + 
  labs(x = "Curiosity group", y = "corrected hit rate")

MeanSrcAccCurGrpOrdPlot
```

```{r, echo = FALSE}
outside.hit.rate.item.order.curiosity[!is.na(CurGrp), .(Mean = mean(SrcAcc, na.rm = TRUE), SD = sd(SrcAcc, na.rm = TRUE), N = length(SrcAcc)), by = c("CurGrp", "ObjOrdGrp")]
```

```{r, echo=FALSE}
baseline  <- lme(SrcAcc ~ 1, random = ~ 1 + CurGrp + ObjOrdGrp|SubjectNo, data = outside.hit.rate.item.order.curiosity[!is.na(CurGrp)], method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE), na.action = na.exclude)
ord.model <- update(baseline,  .~. + ObjOrdGrp)
cur.model <- update(ord.model, .~. + CurGrp)
int.model <- update(cur.model, .~. + ObjOrdGrp : CurGrp)

anova(baseline, ord.model, cur.model, int.model)
```

```{r, echo = FALSE}
summary(int.model)
```

##### *Post hoc*
```{r, echo=FALSE}
contrast.matrix <- rbind(
        "Early: High vs. Low"         = c(0, 0, 1, 0),
        "Late:  High vs. Low"         = c(0, 0, 1, 1)
)
comps <- glht(int.model, contrast.matrix)
summary(comps, test = adjusted("none"))
```

### Separate the groups according to the median rating of each participant
- *High*: curiosity rating > median of the participant
- *Low*: curiosity rating < median of the participant

```{r echo=FALSE}
outside.hit.rate.curiosity.group.median$CurGrpMedian <- factor(outside.hit.rate.curiosity.group.median$CurGrpMedian)
outside.hit.rate.curiosity.group.median$CurGrpMedian <- factor(outside.hit.rate.curiosity.group.median$CurGrpMedian, levels = levels(outside.hit.rate.curiosity.group.median$CurGrpMedian)[c(2, 1)])

outside.hit.rate.item.order.curiosity.median$CurGrpMedian <- factor(outside.hit.rate.item.order.curiosity.median$CurGrpMedian)
outside.hit.rate.item.order.curiosity.median$CurGrpMedian <- factor(outside.hit.rate.item.order.curiosity.median$CurGrpMedian, levels = levels(outside.hit.rate.item.order.curiosity.median$CurGrpMedian)[c(2, 1)])
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=3.6, fig.height=3}
MeanSrcAccCurGrpCmpPlot <- ggplot(outside.hit.rate.curiosity.group.median[!is.na(CurGrpMedian)], aes(x = CurGrpMedian, y = SrcAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  labs(x = "Curiosity group", y = "Corrected hit rate")

MeanSrcAccCurGrpCmpPlot
```

```{r, echo=FALSE}
cur.grp.model <- lme(SrcAcc ~ CurGrpMedian,random = ~ 1 + CurGrpMedian|SubjectNo,  data = outside.hit.rate.curiosity.group.median[!is.na(CurGrpMedian)], method = "ML")
summary(cur.grp.model)
```

#### Curiosity groups and temporal order of the objects
##### Check the data

* **Is there any corrected hit rate < 0?**

```{r, echo=FALSE}
n.negative.SrcAcc <- nrow(outside.hit.rate.item.order.curiosity.median[SrcAcc < 0 & !is.na(CurGrpMedian)])
```

  * There are `r n.negative.SrcAcc` negative values out of a total of `r nrow(outside.hit.rate.item.order.curiosity.median)` participants.

```{r, echo=FALSE}
outside.hit.rate.item.order.curiosity.median[SrcAcc < 0 & !is.na(CurGrpMedian), ]
```

```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.item.order.curiosity.median[SrcAcc < 0 & !is.na(CurGrpMedian)]$SrcAcc <- 0
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=6.4, fig.height=3}
MeanSrcAccCurGrpOrdPlot <- ggplot(outside.hit.rate.item.order.curiosity.median[!is.na(CurGrpMedian)], aes(x = CurGrpMedian, y = SrcAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  facet_wrap( ~ ObjOrdGrp) + 
  labs(x = "Curiosity group", y = "Corrected hit rate")

MeanSrcAccCurGrpOrdPlot
```

```{r, echo = FALSE, warning=FALSE}
outside.hit.rate.item.order.curiosity.median[!is.na(CurGrpMedian), .(Mean = mean(SrcAcc, na.rm = TRUE), SD = sd(SrcAcc, na.rm = TRUE), N = length(SrcAcc)), by = c("CurGrpMedian", "ObjOrdGrp")]

baseline  <- lme(SrcAcc ~ 1, random = ~ 1 + CurGrpMedian + ObjOrdGrp|SubjectNo, data = outside.hit.rate.item.order.curiosity.median[!is.na(CurGrpMedian)], method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE), na.action = na.exclude)
ord.model <- update(baseline,  .~. + ObjOrdGrp)
cur.model <- update(ord.model, .~. + CurGrpMedian)
int.model <- update(cur.model, .~. + ObjOrdGrp : CurGrpMedian)

anova(baseline, ord.model, cur.model, int.model)

summary(int.model)
```

##### *Post hoc*
```{r, echo=FALSE}
contrast.matrix <- rbind(
        "Early: High vs. Low"         = c(0, 0, 1, 0),
        "Late:  High vs. Low"         = c(0, 0, 1, 1)
)
comps <- glht(int.model, contrast.matrix)
summary(comps, test = adjusted("none"))
```

# **Novelty** or **Curiosity**?
```{r, echo=FALSE}
load("../GroupData/OutsideObjectsResponsePerRoom.RData")
```

```{r, echo=FALSE}
source("../../Code/CalFunc.R")

average.curiosity.rating <- outside.hit.rate.per.room[, .(MedianCur = median(CurRating, na.rm = TRUE)), by = c("SubjectNo")]

outside.hit.rate.per.room <- merge(outside.hit.rate.per.room, average.curiosity.rating, by = "SubjectNo")

outside.hit.rate.per.room[, CurGrpMedian    := mapply(CurGrpMedianSep, CurRating, MedianCur) ]
outside.hit.rate.per.room[, CurGrp          := mapply(CurGrpSep,       CurRating)]
```

```{r, echo=FALSE}
# , eval = FALSE, include = FALSE}
outside.hit.rate.per.room[SrcAcc < 0]$SrcAcc <- 0
```


## For Curiosity group splitted by score (*Low*: 1 ~ 3; *High*: 5 ~ 7)
### Curiosity first, novelty next
```{r, echo=FALSE}
base.model    <- lme(SrcAcc ~ 1, random = ~ 1 + CurGrp + Group | SubjectNo, data = outside.hit.rate.per.room[!is.na(CurGrp)], method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE))

cur.scr.model <- update(base.model, .~. + CurGrp)

nov.scr.model <- update(cur.scr.model, .~. + Group)

anova(base.model, cur.scr.model, nov.scr.model)
```

```{r, echo=FALSE}
summary(cur.scr.model)
```


### Novelty first, curiosity next
```{r, echo=FALSE}
nov.scr.model <- update(base.model, .~. + Group)

cur.scr.model <- update(nov.scr.model, .~. + CurGrp)

anova(base.model, nov.scr.model, cur.scr.model)
```

```{r, echo=FALSE}
summary(nov.scr.model)
```


## For Curiosity group splitted by individual medians
### Curiosity first, novelty next
```{r, echo=FALSE}
base.model    <- lme(SrcAcc ~ 1, random = ~ 1 + CurGrpMedian + Group | SubjectNo, data = outside.hit.rate.per.room[!is.na(CurGrpMedian)], method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE))

cur.md.model <- update(base.model, .~. + CurGrpMedian)

nov.md.model <- update(cur.md.model, .~. + Group)

anova(base.model, cur.md.model, nov.md.model)
```

```{r, echo=FALSE}
summary(cur.md.model)
```


### Novelty first, curiosity next
```{r, echo=FALSE}
nov.md.model <- update(base.model, .~. + Group)

cur.md.model <- update(nov.md.model, .~. + CurGrpMedian)

anova(base.model, nov.md.model, cur.md.model)
```

```{r, echo=FALSE}
summary(nov.md.model)
```

## For mean curiosity ratings for the *novel* and *familiar* rooms respectively
### Curiosity first, novelty next
```{r}
basic <- lme(SrcAcc ~ 1, random = ~ 1 + Group|SubjectNo, data = outside.hit.rate.novelty.group, method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE), na.action = na.exclude)

cur.m <- update(basic, .~. + MeanCurRt)
nov.m <- update(cur.m, .~. + Group)

anova(basic, cur.m, nov.m)
```

```{r, echo=FALSE}
summary(cur.m)$tTable
```

### Novelty first, curiosity next
```{r}
nov.m <- update(basic, .~. + Group)
cur.m <- update(nov.m, .~. + MeanCurRt)

anova(basic, nov.m, cur.m)
```

```{r, echo=FALSE}
summary(cur.m)$tTable
```


### Testing mediation effect
```{r, echo=FALSE}
fit.1 <- lme(SrcAcc ~ Group, random = ~ 1 + Group|SubjectNo, data = outside.hit.rate.novelty.group, method = "ML")
summary(fit.1)
```

```{r, echo=FALSE}
fit.2 <- lme(MeanCurRt ~ Group, random = ~ 1 + Group|SubjectNo, data = outside.hit.rate.novelty.group, method = "ML")
summary(fit.2)
```

```{r, echo=FALSE}
fit.3 <- lme(SrcAcc ~ MeanCurRt + Group, random = ~ 1 + Group|SubjectNo, data = outside.hit.rate.novelty.group, method = "ML")
summary(fit.3)
```

```{r}
library(RMediation)
a = summary(fit.2)$tTable[2, 1]
se.a = summary(fit.2)$tTable[2,2]
b = summary(fit.3)$tTable[2,1]
se.b = summary(fit.3)$tTable[2,2]

medci(mu.x=a, mu.y=b, se.x=se.a, se.y=se.b, rho=0, alpha=.05, type="prodclin", plot=TRUE, plotCI=TRUE)
```


