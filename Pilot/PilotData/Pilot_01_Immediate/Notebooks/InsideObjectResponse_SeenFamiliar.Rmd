---
title: "Memory performance for objects inside the rooms"
output: 
      html_notebook:
          fig_caption: yes
          highlight: default
          number_sections: yes
          theme: lumen
          toc: yes
          toc_depth: 5
          toc_float: true
          
      header-includes:
            - \usepackage{xcolor}
            - \usepackage{framed}
            - \usepackage{fontspec}
---

\setmainfont{Noto Sans}
\colorlet{shadecolor}{gray!10}
\color{red}

<style>
body {
  font-size: 15px;
}

p.caption {
  font-weight: 500;
  font-style: italic;
}

code.r {
  font-family: Consolas, Monaco, monospace;
  font-size: 12px;
}
</style>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)
options(knitr.table.format = "html", cache=TRUE) # "latex" for PDF
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
library(data.table); library(ggplot2); library(nlme); library(ez)
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
load("../GroupData/InsideObjectResponseFrequencies.RData")
```

# Visual inspection of the data
```{r Find out bad participants, echo=FALSE}
bad.ps.less.strict <- NULL

participants <- as.character(unique(Encoding.Recall.Freq.Rsp$SubjectNo))

for (this.p in participants) {
  this.data <- Encoding.Recall.Freq.Rsp[SubjectNo == this.p]
  if (this.data[CorrObjResp == "New" & Response == "Seen"]$Frequency > this.data[CorrObjResp == "Seen" & Response == "Seen"]$Frequency) {
    bad.ps.less.strict <- c(bad.ps.less.strict, this.p)
  }
}

if (length(bad.ps.less.strict) > 0) { print(bad.ps.less.strict) }

Encoding.Recall.Freq.Grp$Type2 <- "Good"
Encoding.Recall.Freq.Grp[SubjectNo %in% bad.ps.less.strict]$Type2 <- "Bad"

Encoding.Recall.Freq.Rsp$Type2 <- "Good"
Encoding.Recall.Freq.Rsp[SubjectNo %in% bad.ps.less.strict]$Type2 <- "Bad"
```


```{r, echo=FALSE, fig.align='center', fig.width=9.6, fig.height=12}
IdvRspTypeFreqPlot <- ggplot(Encoding.Recall.Freq.Rsp, aes(x = Response, y = Frequency, group = CorrObjResp)) + theme_bw() +
  geom_rect(data = subset(Encoding.Recall.Freq.Rsp,Type2 == 'Bad'),aes(fill = Type2),xmin = -Inf,xmax = Inf,ymin = -Inf,ymax = Inf,alpha = 0.1) +
  geom_point(size = 3, aes(color = CorrObjResp)) +
  geom_line(size = 0.75, aes(color = CorrObjResp)) +
  scale_x_discrete("Response", limits = c("Seen", "Familiar", "New")) +
  scale_color_brewer(palette = "Set1", labels = c("New items", "Old items")) +
  facet_wrap( ~ SubjectNo, ncol = 4) + 
  theme(strip.text = element_text(face = 'bold'),
        legend.title = element_blank(),
        axis.text.x = element_text(angle = 45, vjust = 0.5) )

IdvRspTypeFreqPlot
```


```{r, echo=FALSE, fig.align='center', fig.width=9.6, fig.height= 12}
IdvRspTypeNoveltyPlot <- ggplot(Encoding.Recall.Freq.Grp, aes(x = Response, y = Frequency, group = Group)) + theme_bw() +
  geom_rect(data = subset(Encoding.Recall.Freq.Grp,Type2 == 'Bad'),aes(fill = Type2),xmin = -Inf,xmax = Inf,ymin = -Inf,ymax = Inf,alpha = 0.1) +
  geom_point(size = 3, aes(color = Group)) +
  geom_line(size = 0.75, aes(color = Group)) +
  scale_x_discrete("Response", limits = c("Seen", "Familiar", "New")) +
  scale_color_brewer(palette = "Set1", labels = c("Distractor", "In familiar room", "In novel room")) +
  facet_wrap( ~ SubjectNo, ncol = 4) + 
  theme(strip.text = element_text(face = 'bold'),
        legend.title = element_blank(),
        axis.text.x = element_text(angle = 45, vjust = 0.5) )

IdvRspTypeNoveltyPlot
```

# Novelty Benefits 

## Compare mean accuracy between *novel* and *familiar* rooms
```{r, echo=FALSE}
load("../GroupData/InsideObjectResponseNoveltyGroups.RData")
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=3.6, fig.height=3, fig.cap='Figure1. Mean accuracy for item memory respectively for Familiar and Novel rooms.'}
MeanSFAccNoveltyCmpPlot <- ggplot(inside.hit.rate.novelty.group[!SubjectNo %in% bad.ps.less.strict], aes(x = Group, y = SFAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  labs(x = "Room novelty", y = "corrected hit rate (\"Seen\" and \"Familiar\"")

MeanSFAccNoveltyCmpPlot
```

```{r, echo = FALSE}
inside.hit.rate.novelty.group[, .(Mean = mean(SFAcc, na.rm = TRUE), SD = sd(SFAcc, na.rm = TRUE), N = length(SFAcc)), by = c("Group")]
t.test(SFAcc ~ Group, data = inside.hit.rate.novelty.group, paired = TRUE)
```

## Any difference between *Early* and *Later* object groups?
```{r, echo = FALSE}
load("../GroupData/InsideObjectResponseItemOrders.RData")
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=4.8, fig.height=3}
MeanSFAccNoveltyTmpOrdCmpPlot <- ggplot(inside.hit.rate.item.order.novelty[!SubjectNo %in% bad.ps.less.strict], aes(x = Group, y = SFAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  facet_wrap( ~ ObjOrdGrp) +
  labs(x = "Room novelty", y = "corrected hit rate (\"Seen\" and \"Familiar\"")

MeanSFAccNoveltyTmpOrdCmpPlot
```

```{r, echo = FALSE, warning=FALSE}
inside.hit.rate.item.order.novelty[, .(Mean = mean(SFAcc, na.rm = TRUE), SD = sd(SFAcc, na.rm = TRUE), N = length(SFAcc)), by = c("Group", "ObjOrdGrp")]

ezANOVA(inside.hit.rate.item.order.novelty, dv = .(SFAcc), wid = .(SubjectNo), within = .(Group, ObjOrdGrp))
```

# Curiosity Enhancement
```{r, echo=FALSE}
load("../GroupData/InsideObjectsResponsePerRoom.RData")
load("../GroupData/InsideObjectResponseEncodingGroups.RData")
```
  
## Mean accuracy of item memory as a function of curiosity rating
```{r, echo=FALSE, fig.align='center', fig.width=3.6, fig.height=3}
ggplot(inside.hit.rate.per.room, aes(x = CurRating, y = SFAcc)) +
  stat_summary(fun.data = mean_cl_boot, na.rm = T, geom = "errorbar", width = 0.2) +
  stat_summary(fun.y = mean, na.rm = T, geom = "point", size = 2) +
  stat_smooth(method = "lm", se = FALSE) +
  scale_x_continuous(breaks = c(1:7)) +
  labs(x = "Curiosity rating", y = "corrected hit rate (\"Seen\" and \"Familiar\"") 
```

## Testing the relationship between mean accuracy of item memory and curiosity rating
Build models with item memory accuracy as $y$ and examine effects of curiosity rating by including it into the model and then comparing the model fits. 

* `baseline.rating` is the model with only an intercept, showing no change in item memory as a function of curiosity rating. 
* `rating.intercept` is the model with $\small EncodingRating$ included, showing the effects of curiosity rating. 
* `rating.slope` is the model allowing the slope (i.e., relationship between item memory and curiosity rating) varying across participants. 

```{r, echo = FALSE}
baseline.rating <- lme(SFAcc ~ 1, random = ~ 1|SubjectNo, data = inside.hit.rate.per.room, method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE), na.action = na.exclude)

rating.intercept <- update(baseline.rating, .~. + CurRating)
rating.slope     <- update(rating.intercept, random = ~ 1 + CurRating|SubjectNo)

anova(baseline.rating, rating.intercept, rating.slope)
```

## Check the curiosity groups

- *High*: curiosity rating > 4
- *Low*: curiosity rating < 4
- For curiosity rating = 4, discarded

```{r echo=FALSE}
inside.hit.rate.curiosity.group$CurGrp <- factor(inside.hit.rate.curiosity.group$CurGrp)
inside.hit.rate.curiosity.group$CurGrp <- factor(inside.hit.rate.curiosity.group$CurGrp, levels = levels(inside.hit.rate.curiosity.group$CurGrp)[c(2, 1)])
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=3.6, fig.height=3}
MeanSFAccCurGrpCmpPlot <- ggplot(inside.hit.rate.curiosity.group[!SubjectNo %in% bad.ps.less.strict], aes(x = CurGrp, y = SFAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  labs(x = "Curiosity group", y = "Corrected hit rate for \"seen\" and \"familiar\"")

MeanSFAccCurGrpCmpPlot
```

```{r, echo=FALSE}
cur.grp.model <- lme(SFAcc ~ CurGrp,random = ~ 1 + CurGrp|SubjectNo,  data = inside.hit.rate.curiosity.group, method = "ML")
summary(cur.grp.model)
```

## Curiosity groups and temporal order of the objects
```{r echo=FALSE}
inside.hit.rate.item.order.curiosity$CurGrp <- factor(inside.hit.rate.item.order.curiosity$CurGrp)
inside.hit.rate.item.order.curiosity$CurGrp <- factor(inside.hit.rate.item.order.curiosity$CurGrp, levels = levels(inside.hit.rate.item.order.curiosity$CurGrp)[c(2, 1)])
```

```{r, echo=FALSE, warning=FALSE, fig.align='center', fig.width=6.4, fig.height=3}
MeanSFAccCurGrpOrdPlot <- ggplot(inside.hit.rate.item.order.curiosity[!SubjectNo %in% bad.ps.less.strict & !is.na(CurGrp)], aes(x = CurGrp, y = SFAcc)) +
  stat_summary(fun.y = mean, geom = "bar") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2) +
  facet_wrap( ~ ObjOrdGrp) + 
  labs(x = "Curiosity group", y = "Corrected hit rate for \"seen\" and \"familiar\"")

MeanSFAccCurGrpOrdPlot
```

```{r, echo = FALSE, warning=FALSE}
inside.hit.rate.item.order.curiosity[, .(Mean = mean(SFAcc, na.rm = TRUE), SD = sd(SFAcc, na.rm = TRUE), N = length(SFAcc)), by = c("CurGrp", "ObjOrdGrp")]

baseline  <- lme(SFAcc ~ 1, random = ~ 1 + CurGrp + ObjOrdGrp|SubjectNo, data = inside.hit.rate.item.order.curiosity[!is.na(CurGrp)], method = "ML", control = list(msMaxIter = 500, opt = "optim", msVerbose=FALSE), na.action = na.exclude)
ord.model <- update(baseline,  .~. + ObjOrdGrp)
cur.model <- update(ord.model, .~. + CurGrp)
int.model <- update(cur.model, .~. + ObjOrdGrp : CurGrp)

anova(baseline, ord.model, cur.model, int.model)
```


