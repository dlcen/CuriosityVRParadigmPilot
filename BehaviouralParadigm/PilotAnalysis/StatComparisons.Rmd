---
title: "Comparing the groups"
output: 
  html_document:
    fig_caption: yes
    highlight: default
    number_sections: no
    theme: lumen
    toc: yes
    toc_depth: 5
    toc_float: true

  pdf_document:
    toc: yes
    toc_depth: 5
    number_sections: no
    highlight: tango
    latex_engine: xelatex
  fontsize: 12pt
---

\setmainfont{Noto Sans}
\setmathfont{Fira Code}
\colorlet{shadecolor}{gray!10}

<style>
body {
  font-size: 15px;
}

p.caption {
  font-weight: 500;
  font-style: italic;
}

code.r {
  font-family: Consolas, Monaco, monospace;
  font-size: 12px;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)
options(knitr.table.format = "html", cache=TRUE) # "latex" for PDF; "html" for html 
```

```{r}
library(data.table); library(ez)
```

```{r load the data}
load("../PilotData/IndividualData.RData")
load("../PilotData/ExcludedSubjectList.RData")
```

```{r remove excluded participants}
outside.hit.rate.item.curiosity.median <- outside.hit.rate.item.curiosity.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.interest.median  <- outside.hit.rate.item.interest.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.surprise.median  <- outside.hit.rate.item.surprise.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.preint.median    <- outside.hit.rate.item.preint.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.presur.median    <- outside.hit.rate.item.presur.median[! SubjectNo %in% excluded.ps]

outside.hit.rate.item.order.curiosity.median <- outside.hit.rate.item.order.curiosity.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.order.interest.median  <- outside.hit.rate.item.order.interest.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.order.surprise.median  <- outside.hit.rate.item.order.surprise.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.order.preint.median    <- outside.hit.rate.item.order.preint.median[! SubjectNo %in% excluded.ps]
outside.hit.rate.item.order.presur.median    <- outside.hit.rate.item.order.presur.median[! SubjectNo %in% excluded.ps]
```

# Compare the *Curiosity* groups
```{r}
outside.hit.rate.item.curiosity.median[,. (Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(CurGrpMd)]
```

**Statistic difference**
```{r}
t.test(SAcc ~ CurGrpMd, outside.hit.rate.item.curiosity.median, paired = T)
```

## Include the item order
```{r}
outside.hit.rate.item.order.curiosity.median[, .(Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(CurGrpMd, ObjOrdGrp)]
```

**Statistic difference**
```{r}
ezANOVA(outside.hit.rate.item.order.curiosity.median, dv = .(SAcc), wid = .(SubjectNo), within = .(CurGrpMd, ObjOrdGrp), type = 3)
```

# Compare the *Interest* groups
```{r}
outside.hit.rate.item.interest.median[,. (Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(IntGrpMd)]
```

**Statistic difference**
```{r}
t.test(SAcc ~ IntGrpMd, outside.hit.rate.item.interest.median, paired = T)
```

## Include the item order
```{r}
outside.hit.rate.item.order.interest.median[, .(Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(IntGrpMd, ObjOrdGrp)]
```

**Statistic difference**
```{r}
ezANOVA(outside.hit.rate.item.order.interest.median, dv = .(SAcc), wid = .(SubjectNo), within = .(IntGrpMd, ObjOrdGrp), type = 3)
```

# Compare the *Surprise* groups
```{r}
outside.hit.rate.item.surprise.median[,. (Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(SurGrpMd)]
```

**Statistic difference**
```{r}
t.test(SAcc ~ SurGrpMd, outside.hit.rate.item.surprise.median, paired = T)
```

## Include the item order
```{r}
outside.hit.rate.item.order.surprise.median[, .(Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(SurGrpMd, ObjOrdGrp)]
```

**Statistic difference**
```{r}
ezANOVA(outside.hit.rate.item.order.surprise.median, dv = .(SAcc), wid = .(SubjectNo), within = .(SurGrpMd, ObjOrdGrp), type = 3)
```


# Compare the *Pre-Interest* groups
```{r}
outside.hit.rate.item.preint.median[,. (Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(PreIntGrpMd)]
```

**Statistic difference**
```{r}
t.test(SAcc ~ PreIntGrpMd, outside.hit.rate.item.preint.median, paired = T)
```

## Include the item order
```{r}
outside.hit.rate.item.order.preint.median[, .(Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(PreIntGrpMd, ObjOrdGrp)]
```

**Statistic difference**
```{r}
ezANOVA(outside.hit.rate.item.order.preint.median, dv = .(SAcc), wid = .(SubjectNo), within = .(PreIntGrpMd, ObjOrdGrp), type = 3)
```

# Compare the *Pre-Surprise* groups
```{r}
outside.hit.rate.item.presur.median[SubjectNo != "P06",. (Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(PreSurGrpMd)]
```

**Statistic difference**
```{r}
t.test(SAcc ~ PreSurGrpMd, outside.hit.rate.item.presur.median[SubjectNo != "P06"], paired = T)
```

## Include the item order
```{r}
outside.hit.rate.item.order.presur.median[SubjectNo != "P06", .(Mean = mean(SAcc, na.rm = T), SD = sd(SAcc, na.rm = T)), by = .(PreSurGrpMd, ObjOrdGrp)]
```

**Statistic difference**
```{r}
ezANOVA(outside.hit.rate.item.order.presur.median[SubjectNo != "P06"], dv = .(SAcc), wid = .(SubjectNo), within = .(PreSurGrpMd, ObjOrdGrp), type = 3)
```

# Check any overlap between *Surprise* groups and *Pre-surprise* groups
```{r}
source("../PilotAnalysis/CalFunc.R")

outside.hit.rate.per.room[, SurGrpMd := mapply(GrpMedianSep, Surprise, MedianSur)]
outside.hit.rate.per.room[, PreSurGrpMd := mapply(GrpMedianSep, PreSur, MedianPreSur)]

# Find out for each participant that the rooms with a surprise score lower/higher than median also has a pre-surprise score lower/higher than median
n.overlapping <- outside.hit.rate.per.room[, .(NOverlappingRooms = sum(as.numeric(SurGrpMd == PreSurGrpMd), na.rm = T)), by = .(SubjectNo)]
n.overlapping
```

```{r}
require(ggplot2)
ggplot(n.overlapping, aes(x = NOverlappingRooms) ) +
  geom_histogram(binwidth = 1, aes(color = SubjectNo, fill = SubjectNo)) +
  geom_vline(aes(xintercept = median(NOverlappingRooms)), color = "red", size = 1) +
	scale_x_continuous(breaks = c(1:9))+
	labs(x = "Number of rooms in the same group", y = "Count") + 
	theme(axis.text = element_text(size = 12),
		  strip.text = element_text(size = 12, face = "bold"))
```




